{"ast":null,"code":"var _jsxFileName = \"/home/nus/TuTran/projects/Web/training/photobook/FE/src/app/views/pages/AdminUpdateBlog/index.js\";\nimport { Button, FormControlLabel, Grid, Switch, TextField, Tooltip, Typography } from '@material-ui/core';\nimport MarkdownEditor from 'app/views/components/MarkdownEditor';\nimport React, { useEffect, useState } from 'react';\nimport BlogQueries from 'graphql/queries/Blog';\nimport BlogMutations from 'graphql/mutations/Blog';\nimport { useLazyQuery, useMutation } from '@apollo/client';\nimport { getMessage } from 'utils/messageConvert';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport LoadingIndicator from 'app/views/components/common/LoadingIndicator';\nimport { withSnackbar } from 'notistack';\nimport { useHistory, useParams } from 'react-router-dom';\nimport PassageImageEditor from '../AdminCreateTest/components/AdminCreateReadingTest/components/PassageImageEdit';\n\nfunction AdminUpdateBlog(props) {\n  const [getBlog, getBlogRes] = useLazyQuery(BlogQueries.GET_BLOG, {\n    onCompleted: res => handleGetSuccess(res),\n    onError: err => handleGetFailure(err)\n  });\n  const [currentBlog, setCurrentBlog] = useState({\n    title: '',\n    image: '',\n    isPublished: false,\n    content: {\n      html: '',\n      text: ''\n    }\n  });\n  const {\n    intl\n  } = props;\n  const params = useParams();\n  const history = useHistory();\n  console.log(currentBlog); // FETCH BLOG\n\n  useEffect(() => {\n    if (!params.id) {\n      history.push('/admin/blogs');\n      return;\n    }\n\n    getBlog({\n      variables: {\n        id: params.id\n      }\n    });\n  }, []);\n\n  const handleGetSuccess = res => {\n    setCurrentBlog(res.post);\n    return;\n  };\n\n  const handleGetFailure = err => {\n    if (!err) {\n      return;\n    }\n\n    let message = getMessage(err.message);\n    props.enqueueSnackbar(intl.formatMessage({\n      id: message\n    }), {\n      variant: 'error',\n      anchorOrigin: {\n        vertical: 'top',\n        horizontal: 'right'\n      }\n    });\n    history.push('/admin/blogs');\n  }; // UPDATE\n\n\n  const [updateBlog, updateBlogRes] = useMutation(BlogMutations.UPDATE_BLOG, {\n    onCompleted: () => handleCreateSuccess(),\n    onError: err => handleCreateFailure(err)\n  });\n\n  const handleCreateSuccess = () => {\n    const messageId = 'MANAGE.BLOGS.UPDATE.SUCCESS';\n    props.enqueueSnackbar(intl.formatMessage({\n      id: messageId\n    }), {\n      variant: 'success',\n      anchorOrigin: {\n        vertical: 'top',\n        horizontal: 'right'\n      }\n    });\n    history.push('/admin/blogs');\n  };\n\n  const handleCreateFailure = err => {\n    if (!err) {\n      return;\n    }\n\n    let message = getMessage(err.message);\n    props.enqueueSnackbar(intl.formatMessage({\n      id: message\n    }), {\n      variant: 'error',\n      anchorOrigin: {\n        vertical: 'top',\n        horizontal: 'right'\n      }\n    });\n  };\n\n  const handleChangeContent = (html, text) => {\n    const newBlog = { ...currentBlog,\n      content: {\n        html: html,\n        text: text\n      }\n    };\n    setCurrentBlog(newBlog);\n  };\n\n  const handleChangeTitle = e => {\n    const newBlog = { ...currentBlog,\n      title: e.target.value\n    };\n    setCurrentBlog(newBlog);\n  };\n\n  const handleChangeIsPublished = event => {\n    const newBlog = { ...currentBlog,\n      isPublished: event.target.checked\n    };\n    setCurrentBlog(newBlog);\n  };\n\n  const handleAddImage = base64String => {\n    const newBlog = { ...currentBlog,\n      image: base64String\n    };\n    setCurrentBlog(newBlog);\n  };\n\n  const handleSubmit = () => {\n    const post = {\n      id: currentBlog.id,\n      image: currentBlog.image,\n      title: currentBlog.title,\n      isPublished: currentBlog.isPublished,\n      content: {\n        html: currentBlog.content.html,\n        text: currentBlog.content.text\n      }\n    };\n    updateBlog({\n      variables: {\n        post: post\n      }\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"kt-portlet kt-portlet--height-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"kt-portlet__head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"kt-portlet__head-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h5\",\n    className: \"kt-portlet__head-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 6\n    }\n  }, \"Blog Editor\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"kt-portlet__body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    label: \"Title\",\n    value: currentBlog.title,\n    variant: \"outlined\",\n    fullWidth: true,\n    onChange: handleChangeTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(FormControlLabel, {\n    className: \"mt-3\",\n    control: /*#__PURE__*/React.createElement(Tooltip, {\n      title: \"If toggled on, the post will be displayed publicly.\",\n      \"aria-label\": \"Is published\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      checked: currentBlog.isPublished,\n      onChange: handleChangeIsPublished,\n      name: \"Is Published\",\n      color: \"primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 10\n      }\n    })),\n    label: \"Is Published\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(PassageImageEditor, {\n    handleAddImage: handleAddImage,\n    src: currentBlog.image,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(MarkdownEditor, {\n    value: currentBlog.content.text,\n    handleChange: handleChangeContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 6\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ml-auto mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    disabled: updateBlogRes.loading,\n    onClick: handleSubmit,\n    variant: \"contained\",\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 6\n    }\n  }, \"Submit\", updateBlogRes.loading && /*#__PURE__*/React.createElement(LoadingIndicator, {\n    width: \"10px\",\n    height: \"10px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 33\n    }\n  })))));\n}\n\nexport default injectIntl(withSnackbar(AdminUpdateBlog));","map":{"version":3,"sources":["/home/nus/TuTran/projects/Web/training/photobook/FE/src/app/views/pages/AdminUpdateBlog/index.js"],"names":["Button","FormControlLabel","Grid","Switch","TextField","Tooltip","Typography","MarkdownEditor","React","useEffect","useState","BlogQueries","BlogMutations","useLazyQuery","useMutation","getMessage","FormattedMessage","injectIntl","LoadingIndicator","withSnackbar","useHistory","useParams","PassageImageEditor","AdminUpdateBlog","props","getBlog","getBlogRes","GET_BLOG","onCompleted","res","handleGetSuccess","onError","err","handleGetFailure","currentBlog","setCurrentBlog","title","image","isPublished","content","html","text","intl","params","history","console","log","id","push","variables","post","message","enqueueSnackbar","formatMessage","variant","anchorOrigin","vertical","horizontal","updateBlog","updateBlogRes","UPDATE_BLOG","handleCreateSuccess","handleCreateFailure","messageId","handleChangeContent","newBlog","handleChangeTitle","e","target","value","handleChangeIsPublished","event","checked","handleAddImage","base64String","handleSubmit","loading"],"mappings":"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","sourcesContent":["import { Button, FormControlLabel, Grid, Switch, TextField, Tooltip, Typography } from '@material-ui/core';\nimport MarkdownEditor from 'app/views/components/MarkdownEditor';\nimport React, { useEffect, useState } from 'react';\nimport BlogQueries from 'graphql/queries/Blog';\nimport BlogMutations from 'graphql/mutations/Blog';\nimport { useLazyQuery, useMutation } from '@apollo/client';\nimport { getMessage } from 'utils/messageConvert';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport LoadingIndicator from 'app/views/components/common/LoadingIndicator';\nimport { withSnackbar } from 'notistack';\nimport { useHistory, useParams } from 'react-router-dom';\nimport PassageImageEditor from '../AdminCreateTest/components/AdminCreateReadingTest/components/PassageImageEdit';\n\nfunction AdminUpdateBlog(props) {\n\tconst [getBlog, getBlogRes] = useLazyQuery(BlogQueries.GET_BLOG, {\n\t\tonCompleted: res => handleGetSuccess(res),\n\t\tonError: err => handleGetFailure(err),\n\t});\n\tconst [currentBlog, setCurrentBlog] = useState({\n\t\ttitle: '',\n\t\timage: '',\n\t\tisPublished: false,\n\t\tcontent: { html: '', text: '' },\n\t});\n\tconst { intl } = props;\n\tconst params = useParams();\n\tconst history = useHistory();\n\tconsole.log(currentBlog);\n\n\t// FETCH BLOG\n\tuseEffect(() => {\n\t\tif (!params.id) {\n\t\t\thistory.push('/admin/blogs');\n\t\t\treturn;\n\t\t}\n\n\t\tgetBlog({ variables: { id: params.id } });\n\t}, []);\n\n\tconst handleGetSuccess = res => {\n\t\tsetCurrentBlog(res.post);\n\t\treturn;\n\t};\n\n\tconst handleGetFailure = err => {\n\t\tif (!err) {\n\t\t\treturn;\n\t\t}\n\t\tlet message = getMessage(err.message);\n\n\t\tprops.enqueueSnackbar(\n\t\t\tintl.formatMessage({\n\t\t\t\tid: message,\n\t\t\t}),\n\t\t\t{\n\t\t\t\tvariant: 'error',\n\t\t\t\tanchorOrigin: {\n\t\t\t\t\tvertical: 'top',\n\t\t\t\t\thorizontal: 'right',\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\thistory.push('/admin/blogs');\n\t};\n\n\t// UPDATE\n\tconst [updateBlog, updateBlogRes] = useMutation(BlogMutations.UPDATE_BLOG, {\n\t\tonCompleted: () => handleCreateSuccess(),\n\t\tonError: err => handleCreateFailure(err),\n\t});\n\n\tconst handleCreateSuccess = () => {\n\t\tconst messageId = 'MANAGE.BLOGS.UPDATE.SUCCESS';\n\t\tprops.enqueueSnackbar(\n\t\t\tintl.formatMessage({\n\t\t\t\tid: messageId,\n\t\t\t}),\n\t\t\t{\n\t\t\t\tvariant: 'success',\n\t\t\t\tanchorOrigin: {\n\t\t\t\t\tvertical: 'top',\n\t\t\t\t\thorizontal: 'right',\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\thistory.push('/admin/blogs');\n\t};\n\n\tconst handleCreateFailure = err => {\n\t\tif (!err) {\n\t\t\treturn;\n\t\t}\n\t\tlet message = getMessage(err.message);\n\n\t\tprops.enqueueSnackbar(\n\t\t\tintl.formatMessage({\n\t\t\t\tid: message,\n\t\t\t}),\n\t\t\t{\n\t\t\t\tvariant: 'error',\n\t\t\t\tanchorOrigin: {\n\t\t\t\t\tvertical: 'top',\n\t\t\t\t\thorizontal: 'right',\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t};\n\n\tconst handleChangeContent = (html, text) => {\n\t\tconst newBlog = { ...currentBlog, content: { html: html, text: text } };\n\t\tsetCurrentBlog(newBlog);\n\t};\n\n\tconst handleChangeTitle = e => {\n\t\tconst newBlog = { ...currentBlog, title: e.target.value };\n\t\tsetCurrentBlog(newBlog);\n\t};\n\n\tconst handleChangeIsPublished = event => {\n\t\tconst newBlog = { ...currentBlog, isPublished: event.target.checked };\n\t\tsetCurrentBlog(newBlog);\n\t};\n\n\tconst handleAddImage = base64String => {\n\t\tconst newBlog = { ...currentBlog, image: base64String };\n\t\tsetCurrentBlog(newBlog);\n\t};\n\n\tconst handleSubmit = () => {\n\t\tconst post = {\n\t\t\tid: currentBlog.id,\n\t\t\timage: currentBlog.image,\n\t\t\ttitle: currentBlog.title,\n\t\t\tisPublished: currentBlog.isPublished,\n\t\t\tcontent: { html: currentBlog.content.html, text: currentBlog.content.text },\n\t\t};\n\n\t\tupdateBlog({ variables: { post: post } });\n\t};\n\n\treturn (\n\t\t<div className=\"kt-portlet kt-portlet--height-fluid\">\n\t\t\t<div className=\"kt-portlet__head\">\n\t\t\t\t<div className=\"kt-portlet__head-label\">\n\t\t\t\t\t<Typography variant=\"h5\" className=\"kt-portlet__head-title\">\n\t\t\t\t\t\tBlog Editor\n\t\t\t\t\t</Typography>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"kt-portlet__body\">\n\t\t\t\t<Grid container spacing={3}>\n\t\t\t\t\t<Grid item xs={12} md={6}>\n\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\tid=\"outlined-basic\"\n\t\t\t\t\t\t\tlabel=\"Title\"\n\t\t\t\t\t\t\tvalue={currentBlog.title}\n\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\tfullWidth\n\t\t\t\t\t\t\tonChange={handleChangeTitle}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<FormControlLabel\n\t\t\t\t\t\t\tclassName=\"mt-3\"\n\t\t\t\t\t\t\tcontrol={\n\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\ttitle=\"If toggled on, the post will be displayed publicly.\"\n\t\t\t\t\t\t\t\t\taria-label=\"Is published\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tchecked={currentBlog.isPublished}\n\t\t\t\t\t\t\t\t\t\tonChange={handleChangeIsPublished}\n\t\t\t\t\t\t\t\t\t\tname=\"Is Published\"\n\t\t\t\t\t\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlabel=\"Is Published\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Grid>\n\t\t\t\t\t<Grid item xs={12} md={6}>\n\t\t\t\t\t\t<PassageImageEditor\n\t\t\t\t\t\t\thandleAddImage={handleAddImage}\n\t\t\t\t\t\t\tsrc={currentBlog.image}\n\t\t\t\t\t\t></PassageImageEditor>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\n\t\t\t\t<div className=\"mt-5\">\n\t\t\t\t\t<MarkdownEditor value={currentBlog.content.text} handleChange={handleChangeContent} />\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"ml-auto mt-5\">\n\t\t\t\t\t<Button disabled={updateBlogRes.loading} onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n\t\t\t\t\t\tSubmit\n\t\t\t\t\t\t{updateBlogRes.loading && <LoadingIndicator width=\"10px\" height=\"10px\"></LoadingIndicator>}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default injectIntl(withSnackbar(AdminUpdateBlog));\n"]},"metadata":{},"sourceType":"module"}